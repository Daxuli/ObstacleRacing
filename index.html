<!doctype html>
<html>
<head>

    <link href="static/estilos.css" rel="stylesheet">
    <title>Obstacle Racing</title>
    <script src="http://code.jquery.com/jquery-2.0.0.js"></script>
    <script>
        $(document).ready(function () {
            //change example.com with your IP or your host
            var ws = new WebSocket("ws://Localhost:8888/ws");
            ws.onopen = function(evt) {
                var conn_status = document.getElementById('conn_text');
                conn_status.innerHTML = "Connection status: Connected!"
            };
            ws.onmessage = function(evt) {
                var coche1 = document.getElementById("coche1");
                var coche2 = document.getElementById("coche2");
                var obj = JSON.parse(evt.data);
                var index = parseInt(obj.index);
                var mapa = obj.map;
                console.log(mapa[0][0]);  // todo esto es para mostrar que si reconoce
                var message = JSON.parse(obj.msg);  // con esto consigo obtener un array en js
                var position1 = 20*parseInt(message[0]);
                var position2 = 400 + 20*parseInt(message[1]);
                coche1.style.left = position1 + "px";
                coche2.style.left = position2 + "px";

            };
            ws.onclose = function(evt) {
                alert ("Connection closed");
            };
            document.onkeydown = checkPress;
            function checkPress(evt) {
                evt = evt || event;
                if (evt.keyCode == 37) {
                    evt.preventDefault();
                    var message = 'L';
                    var str1 = `{"msg": "${message || 'default'}" }`;
                    ws.send(str1);
                }
                if (evt.keyCode == 39) {
                    var message = 'R';
                    <!--With this line the dict format is constructed-->
                    <!--note that the ` is crucial-->
                    var str1 = `{"msg": "${message || 'default'}" }`;
                    ws.send(str1);
                }
                if (evt.keyCode == 32) {
                    var text1 = document.getElementById("text1");
                    text1.style.color = "white";
                    var message = 'play';
                    var str1 = `{"go": "${message || 'default'}" }`;
                    ws.send(str1);
                }
            }

        });

    </script>
</head>
<body>
    <div class="center">
        <h2>Obstacle Racing</h2>
            <label id="conn_text"></label><br />
        <h3 id="text1">Pulse espacio para empezar</h3>
    </div>
    <div class="divcenter" style="width:600px; height: 400px;">
        <div id="coche1"><img  src="static/bluecar.svg" type="image/svg+xml"/></div>
        <div id="coche2"><img   src="static/yellowcar.svg" type="image/svg+xml"/></div>
        <svg style="width:600px; height: 400px; ">
            <rect x="0"  y="0" width="200" height="400" fill=#D3D3D3 />
            <rect x="400"  y="0" width="200" height="400" fill=#D3D3D3 />
            <rect x="0"  y="0" width="20" height="400" fill=#66ff66 />
            <rect x="180"  y="0" width="20" height="400" fill=#66ff66 />
            <rect x="400"  y="0" width="20" height="400" fill=#66ff66 />
            <rect x="580"  y="0" width="20" height="400" fill=#66ff66 />
            <circle cx="110" cy="290" r="10" fill="red" />
            <circle cx="510" cy="290" r="10" fill="yellow" />
        </svg>
    </div>

</body>
</html>